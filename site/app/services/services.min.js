"use strict";external.factory("sessionInjector",["$localStorage","$q",function($localStorage,$q){var session={request:function(config){return config.headers=config.headers||{},$localStorage.token&&$localStorage.user&&(config.headers.token=$localStorage.token),config},response:function(response){return response||$q.when(response)}};return session}]),external.factory("authServices",["$sessionStorage","$localStorage","$rootScope","$window","$location","$http","servicesConfig","peopleServices","baseUrls","redirect","$timeout","urlafterlogin",function($sessionStorage,$localStorage,$rootScope,$window,$location,$http,servicesConfig,peopleServices,baseUrls,redirect,$timeout,urlafterlogin){var authServices={_debug:!1,_setAuthData:function(){},_authenticationChanged:function(){},msgUserFail:{response:{status:"Fail",messages:{message:[{text:"Desculpe! Cliente não encontrado. Tente mais tarde!"}]}}},msgPointsFail:{response:{status:"Fail",messages:{message:[{text:"Desculpe! Pontuação não encontrada. Tente mais tarde!"}]}}},msgSessionFail:{response:{status:"Fail",expired:!0,messages:{message:[{text:"Sessão expirada! Por favor, faça o login novamente!"}]}}},authenticate:function(auth,pageCurrent,callback,reloadPerson){if($localStorage.token)if($http.defaults.headers.common.token=$localStorage.token,!$localStorage.user&&$localStorage.login||reloadPerson)peopleServices.loadPerson($localStorage.login,function(data){return $rootScope.user=data,$rootScope.user.cpf=data.idUsuario,$rootScope.user.cpfFormat=data.idUsuario.replace(/([0-9]{3})([0-9]{3})([0-9]{2}$)/g,".$1.$2-$3"),$rootScope.user.href=servicesConfig.user.layout.links.perfil.href+data.idUsuario,$localStorage.user=JSON.stringify($rootScope.user),angular.isFunction(callback)?authServices.points(callback(data)):authServices.points(),!0},function(){return $rootScope.mainMsgs={response:authServices.msgUserFail.response},authServices.logout(),!1});else{if($localStorage.login)return $rootScope.user=JSON.parse($localStorage.user),angular.isFunction(callback)?authServices.points(callback()):authServices.points(),!0;$rootScope.mainMsgs={response:authServices.msgUserFail.response},authServices.logout()}else auth&&$localStorage.user&&($rootScope.user=JSON.parse($localStorage.user)),angular.isFunction(callback)&&callback()},points:function(callback){servicesConfig.endpoints.points&&$localStorage.user&&($rootScope.user.points="",peopleServices.loadPoints($localStorage.login,function(data){var response=data.response?data.response:data;"Ok"==response.status?($rootScope.user.points=data.body.content.line[0].field[0],$localStorage.user=JSON.stringify($rootScope.user)):authServices.logout("",response),$timeout(function(){angular.isFunction(callback)},500)},function(){$rootScope.mainMsgs={response:authServices.msgPointsFail.response},authServices.logout()}))},getUserData:function(){},isAuthenticated:function(){},login:function(user,redirectLogin,currentLocation){var payload={userName:user[0].value,passwd:user[1].value};return $http({method:"POST",url:servicesConfig.endpoints.auth,data:payload}).success(function(data){$localStorage.token=data.token,$localStorage.login=data.userName,redirectLogin&&(redirectLogin.parameters?"not"!=redirectLogin.urlafter&&currentLocation!=redirectLogin.urlafter&&($rootScope.mainMsgs="",redirect.url(redirectLogin.urlafter,"",redirectLogin)):"not"!=redirectLogin&&currentLocation!=redirectLogin&&($rootScope.mainMsgs="",redirect.url(redirectLogin)))}).error(function(data){var redirectNot="not"!=redirectLogin?!0:!1;return authServices.logout(redirectNot),data})},logout:function(redirectNot,sessionExpired){$rootScope.user=null,delete $localStorage.token,delete $localStorage.login,delete $localStorage.user,delete $localStorage.menu;var urlLocation,layoutLinks=servicesConfig.user.layout.links;if(sessionExpired&&($location.url()!=layoutLinks.login.href&&urlafterlogin.parameter(layoutLinks),sessionExpired.messages&&sessionExpired.messages.message[0].fieldName)){var fieldName=sessionExpired.messages.message[0].fieldName;"expired"==fieldName&&($rootScope.mainMsgs={response:authServices.msgSessionFail.response})}redirectNot||($sessionStorage.urlafterlogin||sessionExpired?layoutLinks.login&&(urlLocation=layoutLinks.login.href):urlLocation=layoutLinks.login&&layoutLinks.login.pagedefault?layoutLinks.login.href:layoutLinks.index.href,$location.path(urlLocation))}};return authServices}]),external.factory("defaultServices",["$rootScope","$resource","$window","$location","$http","servicesConfig","baseUrls","breakParam","formatField","redirect","$filter","authServices","$timeout","urlSetParameter",function($rootScope,$resource,$window,$location,$http,servicesConfig,baseUrls,breakParam,formatField,redirect,$filter,authServices,$timeout,urlSetParameter){var defaultServices={_load:function(urlDestination,parameter){return $http({method:"GET",url:servicesConfig.endpoints.hoot+urlDestination+(parameter?parameter:"")})},_save:function(urlDestination,parameter){return $http({method:"POST",url:servicesConfig.endpoints.hoot+urlDestination,data:parameter})},_delete:function(urlDestination,parameter){return $http({method:"POST",url:servicesConfig.endpoints.hoot+urlDestination,data:parameter})},_del:$resource(servicesConfig.endpoints.people+":personId",{personId:"@id"}),_edit:$resource(servicesConfig.endpoints.people+":personId",{personId:"@id"}),msgdefault:{response:{status:"Fail",messages:{message:[{text:"Falha no serviço. Tente mais tarde!"}]}}},msgload:{response:{status:"Warning",messages:{message:[{text:"Aguarde..."}]}}},delet:function(btn,callback){var msgSucess,deleteUrl,formValid=defaultServices.captureFields(btn.form,!0),form=btn.form,serviceDelete=btn.service?btn.service.delet:btn.form.service.delet;serviceDelete.url&&(deleteUrl=serviceDelete.url);var errorForm,dataDelete={},insertDataDelete=function(array){var nameItem,value;angular.forEach(array,function(index,val){"name"==val&&(nameItem=index),("value"==val||"lineValue"==val)&&(value=index)}),dataDelete[nameItem]=value};if(serviceDelete.captureparameter){var captureRoot=defaultServices.captureRoot(serviceDelete,serviceDelete);captureRoot&&insertDataDelete(captureRoot)}for(var i=0;i<formValid.response.content.length;i++)for(var item=formValid.response.content[i],j=0;j<serviceDelete.parameters.length;j++){var parameter=serviceDelete.parameters[j];if(parameter.captureparameter){var captureRoot=defaultServices.captureRoot(form,parameter);captureRoot?insertDataDelete(captureRoot):errorForm=!0}else(parameter==item.name||parameter.name==item.name)&&(item.value?insertDataDelete(item):errorForm=!0)}if(errorForm)form.msgs={response:{status:"Fail",messages:{message:[{text:"Não foi possível excluir. Por favor, tente mais tarde!"}]}}};else{btn.disabled=!0;{defaultServices._delete(deleteUrl,dataDelete).success(function(successData){btn.disabled=!1,msgSucess=form.msg&&form.msg.success?form.msg.success:"Informações deletadas!",serviceDelete.reload&&defaultServices.reload(serviceDelete.reload),form.msgs={response:{status:"Ok",messages:{message:[{text:msgSucess}]}}},btn.url&&!btn.openmodal&&redirect.url(btn.url,btn),form.response=successData.response,angular.isFunction(callback)&&callback(form)}).error(function(errorData){btn.disabled=!1,btn.url&&!btn.openmodal&&redirect.url(btn.url,btn),form.msgs=errorData.response?errorData:defaultServices.msgdefault})}}},save:function(btn,callback){var formValid,msgSucess,form=btn.form,disabledBtns=function(disabled){if(form.btns)for(var j=0;j<form.btns.length;j++)form.btns[j].disabled=disabled};if(btn.topPagclick&&$("body").animate({scrollTop:0},"slow"),btn.saveAfterForm){var formThis=defaultServices.captureFields(btn.form);formValid=$rootScope&&$rootScope.formPrimary&&"Ok"==formThis.response.status&&$rootScope.formPrimary?defaultServices.captureFields($rootScope.formPrimary.form):formThis}else formValid=defaultServices.captureFields(btn.form);var sendUrl,serviceSend=btn.service?btn.service.send:btn.form.service.send;if(serviceSend.url)if(serviceSend.parameter){var filter=breakParam.breaks($rootScope.user,[serviceSend.parameter]);sendUrl=serviceSend.url+(0==filter.length?0:filter)}else sendUrl=serviceSend.url;if(disabledBtns(!0),"Ok"==formValid.response.status){var dataSend={};serviceSend.createNewobj&&(dataSend[serviceSend.createNewobj.name]={});for(var i=0;i<formValid.response.content.length;i++){var nameItem,value,item=formValid.response.content[i],insertNewObj=!1;if(angular.forEach(item,function(index,val){"name"==val?nameItem=index:"","value"==val?value=index:""}),serviceSend.createNewobj){for(var j=0;j<serviceSend.createNewobj.fields.length;j++){var field=serviceSend.createNewobj.fields[j];if(field==nameItem){insertNewObj=!0;var newObj=dataSend[serviceSend.createNewobj.name];newObj[nameItem]=value}}serviceSend.createNewobj.duplicateObj?insertNewObj=!1:""}insertNewObj||(dataSend[nameItem]=value)}if(btn.url||btn.openmodal||btn.msgIgnore||(form.msgs=defaultServices.msgload),form.edit&&!form.removeEditSave&&(dataSend.edit=!0),serviceSend.notsave){if(serviceSend.saveparameter&&(defaultServices.insertFormsaved(serviceSend.saveparameter,form,form),btn.url&&!btn.openmodal&&redirect.url(btn.url,btn),btn.openmodal&&angular.isFunction(callback)&&callback({response:{status:"Ok"}})),!serviceSend.url&&serviceSend.parameterclicked&&$rootScope.objClicked){var filter;$rootScope.objClicked.length||(filter=$rootScope.objClicked[serviceSend.parameter]),serviceSend.url=filter}disabledBtns(!1)}else{defaultServices._save(sendUrl+".json",dataSend).success(function(successData){$timeout(function(){disabledBtns(!1)},1e3),"Ok"==successData.response.status?(msgSucess=form.msg&&form.msg.success?form.msg.success:"Informações salvas com sucesso!",form.msgs=btn.msgIgnore?"":{response:{status:"Ok",messages:{message:[{text:msgSucess}]}}},serviceSend.saveparameter&&(defaultServices.insertFormsaved(serviceSend.saveparameter,form,form),btn.url&&!btn.openmodal&&redirect.url(btn.url,btn)),btn.clearform&&defaultServices.cleanForm(form),serviceSend.personreload&&authServices.authenticate(!0,"","",!0),angular.isFunction(callback)?(callback(formValid),btn.url&&!btn.openmodal&&(defaultServices.cleanForm(form),redirect.url(btn.url,btn))):btn.url&&!btn.openmodal&&(defaultServices.cleanForm(form),redirect.url(btn.url,btn)),serviceSend.reload&&defaultServices.reload(serviceSend.reload)):form.msgs=btn.msgIgnore?"":successData.response?successData:defaultServices.msgdefault}).error(function(errorData){disabledBtns(!1),form.msgs=btn.msgIgnore?"":errorData.response?errorData:defaultServices.msgdefault})}}else disabledBtns(!1),defaultServices.errorForm(form,formValid,callback)},fieldSet:function(result,callback){if(result.line)for(var i=0;i<result.line.length;i++)for(var fields=result.line[i].field,j=0;j<fields.length;j++)callback&&callback(fields[j])},insertFormsaved:function(saveparameter,serviceForm,formMsg){$rootScope.formsaved=[];for(var i=0;i<saveparameter.length;i++){var captureForm,parameter=saveparameter[i];if("all"==parameter)for(var j=0;j<serviceForm.detail.length;j++)for(var fieldset=serviceForm.detail[j].form,l=0;l<fieldset.length;l++){var campos=fieldset[l].campos;if(campos.length>0)for(var a=0;a<campos.length;a++)$rootScope.formsaved.push(campos[a]);else $rootScope.formsaved.push(campos)}else captureForm=defaultServices.captureForm(serviceForm,parameter,formMsg),$rootScope.formsaved.push({name:parameter,value:captureForm})}},filterHeader:function(serviceFilters,headerFilter,filterPag){var insertParameterUrl=function(campo,objUrl){campo.lineValue&&(campo.value=campo.lineValue.id?campo.lineValue.id:campo.lineValue);var valueDefault=objUrl.valueDefault?objUrl.valueDefault:"0";if(!objUrl.parameterFilter){var filter=breakParam.breaks($rootScope.user,[objUrl.parameter]);return campo.valueOrigin=filterPag?campo.valueOrigin?campo.valueOrigin:valueDefault:filter?filter:valueDefault,campo}return campo.name==objUrl.parameterFilter?(campo.valueOrigin=filterPag?campo.valueOrigin?campo.valueOrigin:valueDefault:campo.value?campo.value:valueDefault,campo):void 0};if(headerFilter.show){var camposFilter=defaultServices.captureFields(headerFilter,!0);if(camposFilter&&"Ok"==camposFilter.response.status){for(var filter,urlFilter="",i=0;i<serviceFilters.length;i++){var servFilter=serviceFilters[i],campoHeaderForm=$filter("filter")(headerFilter.detail[0].form[0].campos,servFilter.parameterFilter)[0];filter=insertParameterUrl(campoHeaderForm,servFilter),filter&&(campoHeaderForm.name==filter.name&&(campoHeaderForm.valueOrigin||(campoHeaderForm.valueOrigin=filter.value)),urlFilter=urlFilter+servFilter.url+filter.valueOrigin)}return urlFilter}}},filterTable:function(obj,filterPag){var table=obj.form.table;table.result={},filterPag=filterPag?obj:!1,table.msgs=defaultServices.msgload,table.conditional={},defaultServices.load(table,"","",filterPag)},search:function(obj,callback){var form=obj.form,formValid=defaultServices.captureFields(form);if(form.service.search){var service=form.service.search;form.msgs="","Ok"==formValid.response.status?(form=defaultServices.loopFiedsForm(form,function(data){data.name==service.parameter&&(data.lineValue?service.value=data.lineValue:"")}),defaultServices.reload(form.service.search.reload,form.service.search)):defaultServices.errorForm(form,formValid,callback)}},loopFiedsForm:function(form,callback){for(var i=0;i<form.detail.length;i++)for(var formObj=form.detail[i].form,j=0;j<formObj.length;j++)for(var campos=formObj[j].campos,l=0;l<campos.length;l++){var campo=campos[l];callback&&callback(campo)}return form},load:function(obj,callback,search,filterPag){var urlService,serv=search?search:obj.event?obj:obj.urls||obj.url?obj:obj.service.search?obj.service.search:obj.service.call,objAll=[],objDefault=[],clearObj=objDefault.push(obj)[0],fnCall=function(service,multipleServices,index){if(obj.filter){var validate={};validate.detail=obj.form.header.filter.detail,validate.tplform=obj.form.tplform;var formValid=defaultServices.captureFields(validate);"Ok"==formValid.response.status&&(obj=obj.form.table)}if(service.parameter)if("search"==service.objresult)service.value&&(urlService=service.url+service.value);else if(service.captureparameter){var captureRoot=defaultServices.captureRoot(service,service);urlService=service.url+captureRoot.value}else{var filter=breakParam.breaks($rootScope.user,[service.parameter]);urlService=service.url+(0==filter.length?0:filter)}else if(service.urls){urlService="";for(var i=0;i<service.urls.length;i++){var filter,url=service.urls[i];if(url.parameterclicked)filter=defaultServices.captureClicked(url.parameter);else if(url.parameterform){if(service.form=service.form?service.form:obj.form?obj.form:obj,filter=defaultServices.captureForm(service.form,url.parameter,obj.form?obj.form:obj,service.conditional,""),filter.response){var form=obj.form?obj.form:obj;return form.msgs=filter,obj.form}var form=obj.form?obj.form:obj;form.msgs="",filter=filter.value?filter.value:filter}else if(url.parameterurl){var setparameterurl=urlSetParameter.parameter(url.parameter);filter=setparameterurl?setparameterurl:0}else if(url.captureparameter){var captureRoot=defaultServices.captureRoot(service,url);filter=captureRoot?captureRoot.value:0}else if(url.setparamObj){if($rootScope.objClicked&&$rootScope.objClicked.params){var captureParam=$filter("filter")($rootScope.objClicked.params,{id:url.parameter},!0)[0];filter=captureParam?captureParam.value:0}}else url.parameterType?"string"==url.parameterType&&(filter=url.parameter):(filter=breakParam.breaks($rootScope.user,[url.parameter]),0==filter.length&&(filter=0));urlService=urlService+url.url+filter}}else urlService=service.url;if(urlService=defaultServices.filterInsert(obj,service,urlService,filterPag)){defaultServices._load(urlService+".json").success(function(successData){if(successData.messages)authServices.logout("",successData);else{var successContent=successData.body.content;if(multipleServices?"":$rootScope.mainMsgs="",successContent.header||successContent.footer||successContent.line||multipleServices){obj.result=successData.body.content;var page=successData.body.page?successData.body.page:{};obj.page=page,obj.page.bigCurrentPage=page.pagenumber,obj.page.bigTotalItems=page.totalrecord,obj.pagination&&(obj.page.totalItems=obj.pagination.totalItems,obj.page.url=obj.pagination.url,obj.page.maxSize=obj.pagination.maxSize,obj.page.boundaryLinks=obj.pagination.boundaryLinks,obj.page.directionLinks=obj.pagination.directionLinks,obj.page.numPagesText=obj.pagination.numPagesText,obj.page.previoustext=obj.pagination.previoustext,obj.page.nexttext=obj.pagination.nexttext,obj.page.firsttext=obj.pagination.firsttext,obj.page.lasttext=obj.pagination.lasttext),multipleServices?"":obj.msgs=""}else obj.msgs={response:successData.response?successData.response:defaultServices.msgdefault.response};var objaditional=obj.aditionals;if(obj.formdisabled&&obj.formdisabled.btns&&defaultServices.disabledBtns(obj),service.filter){var filter=breakParam.breaks(obj.result,[service.filter]);obj.result={line:filter[0]}}if(obj.titles&&obj.result.header&&obj.titles.length>0&&defaultServices.loopLine(obj.titles,obj.result.header,objaditional),obj.body&&obj.result.line&&obj.body.length>0&&defaultServices.loopLine(obj.body,obj.result.line,objaditional),objaditional&&obj.result.line&&((objaditional.field||objaditional.disabled)&&defaultServices.loopLine("",obj.result.line,objaditional),objaditional.setload&&defaultServices.loopLine(obj.form.detail[0].form,obj.result.line,objaditional)),obj.footer&&obj.result.footer&&defaultServices.loopLine(obj.footer,obj.result.footer,objaditional),!multipleServices)return angular.isFunction(callback)&&callback(obj),obj;if(objAll[0]){var resultAll=objAll[0],resultObj=obj.result;if(resultObj.header)for(var j=0;j<resultObj.header.length;j++)resultAll.header.push(resultObj.header[j]);if(resultObj.line){resultAll.line?resultAll.line:resultAll.line=[];for(var j=0;j<resultObj.line.length;j++)resultAll.line.push(resultObj.line[j])}if(resultObj.footer)for(var j=0;j<resultObj.footer.length;j++)resultAll.footer.push(resultObj.footer[j])}else objAll.push(obj.result);if(index==serv.urlsmultiple.length-1)return obj.result=objAll[0],angular.isFunction(callback)&&callback(obj),obj}}).error(function(errorData){return obj.detail||obj.btns?(clearObj||(clearObj={}),clearObj.detail=[],clearObj.btns=[]):clearObj=obj.form?obj.form:obj,service.error?(angular.isFunction(callback)&&callback(clearObj),$rootScope.mainMsgs={response:service.errordefault&&errorData.response?errorData.response:defaultServices.msgdefault.response},$rootScope.mainMsgs.btns=service.btnserror,service.error.hidecontent&&$rootScope.mainMsgs&&($rootScope.mainMsgs.errorcontent=!0),service.error.urlparametererror&&$rootScope.mainMsgs&&($rootScope.mainMsgs.keep=!0,redirect.url(service.error.urlparametererror,service.error))):(clearObj.msgs=errorData&&errorData.response&&errorData.response.messages.message[0].text?errorData:defaultServices.msgdefault,angular.isFunction(callback)&&callback(clearObj)),clearObj})}};if(serv.urlsmultiple)for(var i=0;i<serv.urlsmultiple.length;i++){var serviceI=serv.urlsmultiple[i];fnCall(serviceI,!0,i)}else fnCall(serv)},captureClicked:function(parameter){var filter;return $rootScope.objClicked?(filter=parameter?$filter("filter")($rootScope.objClicked,parameter,!0):$rootScope.objClicked,filter=filter.length>0?filter[0]:filter,filter?(filter.value=filter.lineValue?filter.lineValue:filter.value,filter=filter.value?filter.value.id?filter.value.id:filter.value:0):filter=0):filter=0,filter},filterInsert:function(obj,service,urlService,filterPag){if(filterPag&&(obj.footer={pagination:filterPag.form.table.page}),service.headerfilter&&obj.headerFilter){var urlFilter=defaultServices.filterHeader(service.headerfilter,obj.headerFilter,filterPag?!0:!1);urlFilter?urlService+=urlFilter:""}if(obj.isPagination){var page;if(page=(obj.footer.pagination||obj.page)&&obj.footer.pagination?obj.footer.pagination:obj.page){var totalItems=page.totalItems?page.totalItems:obj.pagination.totalItems;filterPag?totalItems&&(urlService=urlService+page.url+(page.bigCurrentPage?page.bigCurrentPage:1)+"/"+totalItems):totalItems&&(urlService=urlService+page.url+1+"/"+totalItems)}}return urlService},captureRoot:function(service,btn){var filter,filterRoot=breakParam.breaks($rootScope,[btn.captureparameter])[0];if(filterRoot){if(filterRoot.length>0)for(var i=0;i<filterRoot.length;i++)filterRoot[i].name==btn.parameter&&(filter=filterRoot[i]);else{if(filterRoot.detail)return defaultServices.captureForm(filterRoot,btn.parameter,filterRoot,"",btn.dataconstruct);filter={},angular.forEach(filterRoot,function(index,val){val==btn.parameter&&(filter.name=val,filter.value=index)})}if(filter)return filter;if(service.error&&!filterRoot.ignoreparameter&&service.error.urlparametererror)return redirect.url(service.error.urlparametererror,service.error),!1}else if(service.error&&service.error.urlparametererror)return redirect.url(service.error.urlparametererror,service.error),!1},captureForm:function(serviceForm,parameter,formMsg,conditional,dataconstruct){var filter,msgObj=formMsg.msgs,conditionalVal=[];if(serviceForm){for(var j=0;j<serviceForm.detail.length;j++)for(var fieldset=serviceForm.detail[j].form,l=0;l<fieldset.length;l++){var campo=fieldset[l].campos,filterCampo=$filter("filter")(campo,{name:parameter},!0)[0];if(filterCampo&&(filterCampo.lineValue?("date"==filterCampo.type&&filterCampo.clearmask?filterCampo.lineValue=formatField.date(filterCampo.lineValue,!1,!0):filterCampo.lineValue.id||(filterCampo=defaultServices.clearfield(filterCampo)),filter=dataconstruct?filterCampo:filterCampo.lineValue.id?filterCampo.lineValue.id:filterCampo.lineValue):filter=0),conditional)for(var m=0;m<conditional.obj.length;m++){var cond=conditional.obj[m],filterConditional=$filter("filter")(campo,{name:cond.parameter},!0)[0];if(filterConditional){var filterVal=breakParam.breaks(filterConditional,[cond.value],!0)[0];filterVal?conditionalVal.push(filterVal):filterConditional.invalid=!0}}}if(conditional&&conditionalVal.length>0){if(conditionalVal.length!=conditional.obj.length)return conditional.mgsalert&&(msgObj={response:{status:"Warning",messages:{message:[{text:conditional.mgsalert}]}}}),msgObj;msgObj=""}else{if(conditional)return msgObj=conditional.mgsalert?{response:{status:"Warning",messages:{message:[{text:conditional.mgsalert}]}}}:"";msgObj=""}return filter}},errorForm:function(form,formValid,callback){return form.msg&&(form.msg.error&&"Fail"==formValid.response.status&&(formValid.response.messages={message:[{text:form.msg.error}]}),form.msg.warning&&"Warning"==formValid.response.status&&(formValid.response.messages={message:[{text:form.msg.warning}]})),form.msgs=formValid,angular.isFunction(callback)?callback(formValid):form},disabledBtns:function(obj){for(var btnFormDisabled=obj.formdisabled.btns,btnObj=obj.btns,i=0;i<btnFormDisabled.length;i++){var btnDisabeld=btnFormDisabled[i],filterBtn=$filter("filter")(btnObj,btnDisabeld.name,!0)[0];if(filterBtn){var filterParameter,locationSearch=$rootScope.objClicked?$rootScope.objClicked:obj.result.line;btnDisabeld.parameter?(btnDisabeld.captureObj?"this"==btnDisabeld.captureObj&&defaultServices.loopFiedsForm(obj,function(data){data.name==btnDisabeld.parameter&&(filterParameter=data)}):filterParameter=$filter("filter")(locationSearch,btnDisabeld.parameter,!0)[0],filterParameter&&$timeout(function(){filterParameter.defaultHidden||(filterBtn.disabled=btnDisabeld.parametervalue&&!filterBtn.disabled?filterParameter.value==btnDisabeld.parametervalue?!0:!1:!0)},100)):filterBtn.disabled=!0}}},reload:function(reloadContent,objSearch,callback){for(var placeReload,idReload,inspectArray=function(obj,parameter){var result;return angular.forEach(obj,function(index){"result"==parameter?index.result&&(result=index):index.id&&index.id==parameter&&(result=index)}),result},reloadResult=function(obj){objSearch||(obj.result={},obj.page={},obj.msgs=defaultServices.msgload,obj.conditional={}),defaultServices.load(obj,callback,objSearch)},i=0;i<reloadContent.length;i++){var search,reload=reloadContent[i];if(placeReload=breakParam.breaks($rootScope.pageCurrent,[reload.place],!0)[0],placeReload=placeReload[0]?placeReload[0]:placeReload){if("main"==reload.place){var mainSearch=$filter("filter")(placeReload,reload.id,!0);mainSearch&&(search=mainSearch.detail)}else search=placeReload;if(reload.id){var idReload=$filter("filter")(search,{id:reload.id},!0);if(idReload)if(idReload=idReload[0]?idReload[0]:idReload,idReload.result)reloadResult(idReload);else{var inspectId,inspectResult;if(inspectId=inspectArray(idReload,reload.id),inspectId&&(inspectResult=inspectId.result?inspectId:inspectArray(inspectId,"result"),inspectResult?reloadResult(inspectResult):""),reload.idContent){var inspectResultContent,inspectIdContent=inspectArray(idReload,reload.idContent);inspectIdContent&&(inspectResultContent=inspectIdContent.result?inspectIdContent:inspectArray(inspectIdContent,"result"),inspectResultContent?reloadResult(inspectResultContent):"")}}}}}},loopLine:function(element,objData,aditionals){for(var i=0;i<objData.length;i++){var line=objData[i];if(aditionals&&aditionals.iconLine&&("odd"==aditionals.iconLine.type&&(line.iconline=i%2==0?aditionals.iconLine.icons[0]:aditionals.iconLine.icons[1]),"single"==aditionals.iconLine.type&&(aditionals.iconLine.icons[0]?line.iconline=aditionals.iconLine.icons[0]:""),"default"!=aditionals.iconLine.type&&aditionals.iconLine.type||(aditionals.iconLine.icons[i]?line.iconline=aditionals.iconLine.icons[i]:"")),line.field)for(var j=0;j<line.field.length;j++){var field=line.field[j],title=element[j];if(aditionals){if(aditionals.field&&(field.aditionals=aditionals.field,angular.forEach(aditionals.field,function(index,val){field[val]=index}),aditionals.field.insertDinamic)){var insertDinamic=function(fieldDestination){angular.forEach(fieldDestination,function(index,value){angular.forEach(aditionals.field.insertDinamic,function(indexInsert,valueInsert){if(value==indexInsert&&(fieldDestination[valueInsert]=index),angular.isObject(indexInsert))if(indexInsert.length>0)for(var i=0;i<indexInsert.length;i++){var indexFor=indexInsert[i];angular.forEach(indexFor,function(ind){value==ind&&(fieldDestination[valueInsert]=indexInsert)})}else angular.forEach(indexInsert,function(ind){value==ind&&(fieldDestination[valueInsert]=indexInsert)})})})};if(aditionals.field.insertDinamic.destination){var fieldDestination=field[aditionals.field.insertDinamic.destination];if(fieldDestination.length)for(var i=0;i<fieldDestination.length;i++)insertDinamic(fieldDestination[i]);else insertDinamic(fieldDestination)}else insertDinamic(field)}if(aditionals.disabled)for(var l=0;l<aditionals.disabled.length;l++){var disabled=aditionals.disabled[l];disabled.name==field.name&&(field.disabled=!0)}if(aditionals.setload)for(var l=0;l<element.length;l++){var formField=element[l].campos[0];formField.name==field.name&&(formField.lineValue="date"==formField.type?formatField.date(field.value):field.value)}}title&&defaultServices.insertComplement(title,field)}}},insertComplement:function(element,destination){angular.forEach(element,function(index,val){destination[val]?("hidden"!=val||"required"!=val)&&(destination[val]=index):destination[val]=index}),destination.value=null==destination.value?"":destination.value,"data"==destination.name&&(destination.value=formatField.date(destination.value,element.inverter?element.inverter:!1))},clearfield:function(field){return field.lineValue&&(field.lineValue=String(field.lineValue),"cep"==field.name&&(field.lineValue=field.lineValue.replace(/[\-]/g,"")),"cpf"==field.name&&(field.lineValue=field.lineValue.replace(/[\.-]/g,"")),"tel"==field.type&&(field.lineValue=field.lineValue.replace(/[\-() ]/g,"")),"pontos"==field.type&&(field.lineValue=field.lineValue.replace(/[\.]/g,"")),"moeda"==field.type&&(field.lineValue=formatField.moeda(field.lineValue),field.lineValue=field.lineValue.replace(/[\.]/g,""),field.lineValue=field.lineValue.replace(/[\,]/g,"."),field.lineValue=field.lineValue.replace("R$ ","")),("checkbox"==field.type||"radio"==field.type)&&(field.lineValue=1==field.checked?"S":"N")),field},captureFields:function(contentForm,novalid){var errorForm=!1,formSend=[],insertFormSend=function(campo,valueCapture){var campoThis;if(campoThis="lineValue"==valueCapture?campo.lineValue:campo.value,!campo.inputHide){var ignoreCapture=!1;if(campo.defaultHidden&&0!=campo.hidden&&"hidden"!=campo.type&&(ignoreCapture=!0),!ignoreCapture){if(campo.savetype)switch(campo.savetype){case"number":"select"==campo.type?(campo.lineValueClear=campo.lineValue,campo.lineValueClear.id=Number(campo.lineValueClear.id)):null!=campo.lineValueClear&&(campo.lineValueClear=Number(campo.lineValueClear))}if(campo.lineValueClear&&campoThis!=campo.lineValueClear&&(campoThis=campo.lineValueClear),!campo.ignoresave)switch(campo.type){case"select":formSend.push({name:campo.name,value:campoThis?campoThis.id:0});break;case"captcha":defaultServices.getcaptcha(campo);break;case"radio":formSend.push({name:campo.name,value:1==campoThis?"S":"N"});break;case"checkbox":formSend.push({name:campo.name,value:1==campoThis?"S":"N"});break;default:if(campo.name&&"button"!=campo.type){formSend.push({name:campo.name,value:campoThis})}}}}},valid=function(field){contentForm.tplform?contentForm.tplform.$valid?(field.invalid=!1,field.required&&0==field.hidden&&"image"!=field.nameTpl||field.required&&0==field.defaultHidden&&"image"!=field.nameTpl?validLineValue(campo):insertFormSend(campo,"lineValue")):field.required&&"image"!=field.nameTpl&&validLineValue(campo):insertFormSend(campo)},validLineValue=function(field){field.lineValue?(field.invalid=!1,insertFormSend(field,"lineValue")):field.invalid=!0},fieldsInvalid=[],forms=contentForm.detail?contentForm.detail:contentForm;if(forms)for(var a=0;a<forms.length;a++)for(var form=forms[a].form,i=0;i<form.length;i++)for(var linha=form[i],j=0;j<linha.campos.length;j++){var campo=linha.campos[j];if(campo.lineValue&&"select"!=campo.type){var clearVal=defaultServices.clearfield(angular.copy(campo));campo.lineValueClear=clearVal.lineValue}novalid?(campo.invalid=!1,insertFormSend(campo,"lineValue")):(valid(campo),campo.invalid&&fieldsInvalid.push(campo))}return errorForm=fieldsInvalid.length>0?!0:!1,errorForm?{response:{status:"Warning",messages:{message:[{text:"Por favor, preencha os campos corretamente!"}]}}}:{response:{status:"Ok",content:formSend}}},cleanForm:function(form){form.detail=angular.copy(form.formdefault)},getcaptcha:function(campo){var payload={secret:servicesConfig.captcha.secretkey,response:campo.captcha.response};$http({method:"GET",url:"https://www.google.com/recaptcha/api/siteverify",data:payload}).success(function(){})},searchcep:function(btn){{var resultFilter;defaultServices.loopFiedsForm(btn.form,function(data){("cep"==data.name||"cep"==data.type)&&(resultFilter=data)})}resultFilter.lineValue&&$http({method:"GET",url:servicesConfig.endpoints.hoot+"cep/"+resultFilter.lineValue}).success(function(resultcep){defaultServices.loopFiedsForm(btn.form,function(data){("numero"==data.name||"comp"==data.name||"cartaoNumero"==data.name||"cartaoComp"==data.name)&&(data.lineValue="");for(var l=0;l<btn.insertResult.length;l++){var insert=btn.insertResult[l];insert.destiny==data.name&&(angular.forEach(resultcep,function(index,val){if(data.modified=!0,insert.origin==val)if("select"==data.type){if(data.options){var filter=$filter("filter")(data.options.obj,index)[0];data.lineValue=filter}}else data.lineValue=index}),$timeout(function(){data.modified=!1},1500))}})})}};return defaultServices}]),external.factory("modalServices",["$http","$filter","$timeout","modalCall","servicesConfig","defaultServices","baseUrls","$rootScope",function($http,$filter,$timeout,modalCall,servicesConfig,defaultServices,baseUrls,$rootScope){var modalServices={save:function(btn,contentModal,modal){btn.form=contentModal,defaultServices.save(btn,function(data){"Ok"==data.response.status&&0!=contentModal.sucessclose&&(btn.notcloseModal||$timeout(function(){modal.dismiss("close"),btn.openmodal?modalCall.open(btn,btn.url):$rootScope&&$rootScope.formPrimary&&($rootScope.formPrimary="")
},contentModal.timeclose?contentModal.timeclose:1800))})},delet:function(btn,contentModal,modal){btn.form=contentModal,defaultServices.delet(btn,function(data){"Ok"==data.response.status&&(data.texts="",data.btns="",0!=contentModal.sucessclose&&$timeout(function(){modal.dismiss("close"),btn.openmodal?modalCall.open(btn,btn.url):$rootScope&&$rootScope.formPrimary&&($rootScope.formPrimary="")},contentModal.timeclose?contentModal.timeclose:1800))})},getOptions:function(urlOption,callback){var opts=[{value:"00",text:"10"},{value:"Title",text:"Titulo"},{value:"10",text:"20"},{value:"20",text:"30"}];return angular.isFunction(callback)&&callback(opts),opts},disabledBtns:function(obj){defaultServices.disabledBtns(obj)},filterTab:function(list,option){for(var i=0;i<list.length;i++)for(var filterTab=list[i],j=0;j<filterTab.campos.length;j++)filterTab.campos[j].formEdit=option}};return modalServices}]),external.config(function(){}),external.run(function(){}),external.factory("peopleServices",function($resource,servicesConfig){var peopleServices={_Person:$resource(servicesConfig.endpoints.people+":personId",{personId:"@id"}),_Points:$resource(servicesConfig.endpoints.points+":personId",{personId:"@id"}),loadPerson:function(personId,successCallback,errorCallback){var person=this._Person.get({personId:personId},function(successData){angular.isFunction(successCallback)&&successCallback(successData)},function(errorData){angular.isFunction(errorCallback)&&errorCallback(errorData)});return person},loadPoints:function(personId,successCallback,errorCallback){var points=this._Points.get({personId:personId},function(successData){angular.isFunction(successCallback)&&successCallback(successData)},function(errorData){angular.isFunction(errorCallback)&&errorCallback(errorData)});return points}};return peopleServices});